require_relative '../node_modules/react-native/scripts/react_native_pods'
require_relative '../node_modules/@react-native-community/cli-platform-ios/native_modules'

platform :ios, '13.4'

target 'piaoliuapp' do
  config = use_native_modules!

  # ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ RCT-Folly é¿å…ç¼–è¯‘é”™è¯¯
  pod 'RCT-Folly', :podspec => '../node_modules/react-native/third-party-podspecs/RCT-Folly.podspec'
  
  # æ·»åŠ  react-native-vector-icons
  pod 'RNVectorIcons', :path => '../node_modules/react-native-vector-icons'
  
  # WebRTC ç›¸å…³ä¾èµ– (æš‚æ—¶ç¦ç”¨ï¼Œç­‰å¾…ç½‘ç»œé—®é¢˜è§£å†³)
  # pod 'react-native-webrtc', :path => '../node_modules/react-native-webrtc'
  # pod 'RNPermissions', :path => '../node_modules/react-native-permissions'
  # pod 'ReactNativeIncallManager', :path => '../node_modules/react-native-incall-manager'

  # React Native æ ¸å¿ƒåº“
  use_react_native!(
    :path => config[:reactNativePath],
    :hermes_enabled => false,        # ç¦ç”¨ Hermes é¿å… RCT-Folly é—®é¢˜
    :fabric_enabled => false,        # å¯æ”¹ true å¼€å¯æ–°æ¶æ„ Fabric
    :flipper_configuration => FlipperConfiguration.disabled,
    :app_path => "#{Pod::Config.instance.installation_root}/.."
  )

  target 'piaoliuappTests' do
    inherit! :complete
  end

  post_install do |installer|
    react_native_post_install(
      installer,
      :mac_catalyst_enabled => false
    )

    # ğŸ‘‡ æ¨èåŠ ä¸Šè¿™ä¸€æ®µï¼Œè§£å†³ iOS æ„å»ºæ—¶å¤´æ–‡ä»¶æ‰¾ä¸åˆ°çš„é—®é¢˜
    installer.pods_project.targets.each do |target|
      target.build_configurations.each do |config|
        config.build_settings['CLANG_CXX_LANGUAGE_STANDARD'] = 'c++17'
        config.build_settings['CLANG_CXX_LIBRARY'] = 'libc++'
        config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.4'
        
        # è§£å†³ RCT-Folly ç¼–è¯‘é”™è¯¯
        if target.name == 'RCT-Folly'
          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= []
          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'FOLLY_NO_CONFIG=1'
          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'FOLLY_MOBILE=1'
          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'FOLLY_USE_LIBCPP=1'
          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'FOLLY_HAVE_PTHREAD=1'
          # è·³è¿‡æœ‰é—®é¢˜çš„æ–‡ä»¶
          config.build_settings['EXCLUDED_SOURCE_FILE_NAMES'] = 'SysUio.cpp NetOps.cpp FileUtil.cpp'
        end
      end
    end
  end
end
